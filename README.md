# analytics

This is a fork from [philipwalton/analyticsjs-boilerplate](https://github.com/philipwalton/analyticsjs-boilerplate), only **autotrack.js** is currently supported.

I have modified this a little bit to make it work with **Facebook Pixel** as well as setting **custom timezone**, which is required by some autotrack plugins.

I have also added a function called **trackPageview** so that you can send pageview to GA and Pixel whenever the url route of your app changes.

Read below for more details.

## Installation

Three environment variables are required to make this work as expected:

1. `REACT_APP_GA`: (Google Analytics tracking code)
2. `REACT_APP_FBQ`: (Facebook Pixel tracking code)
3. `REACT_APP_TZ`: (Timezone, e.g. 'Asia/Taipei')

Install using **npm**:

```sh
npm install --save https://github.com/shian15810/analytics.git
```

Or install using **yarn**:

```sh
yarn add https://github.com/shian15810/analytics.git
```

Then add this to your **index.html**:

```html
<script>
  !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
  n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
  document,'script','//connect.facebook.net/en_US/fbevents.js');
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
</script>
<script async src="//unpkg.com/autotrack/autotrack.js"></script>
```

## Usage

You can use this package on any framework, but I will demonstrate the example below in **React**.

In your react app, import `init` and execute it before executing `ReactDOM.render`:

```js
import {init} from 'analytics';
import {render} from 'react-dom';
import Root from './Root';

init();
render((<Root/>), document.getElementById('root'));
```

You can also send `pageview` whenever the url route of your app changes, such as with **React Router**:

```js
import {trackPageview} from 'analytics';
import {browserHistory as history} from 'react-router';

history.listen(({pathname}) => trackPageview(pathname));
```

**autotrack.js** has its built-in functionality to send error messages to **GA**, but error from `Promise` is not handled:

```js
import {trackError} from 'analytics';

fetch('/api.json').catch(trackError);
```

In this way, we can ensure all error messages generated by client and `Promise` are handled and sent to **GA**.

Alternatively, you can use another **ES6** `import` styles if that suits you:

```js
import analytics from 'analytics';

const init = analytics.init;
const trackPageview = analytics.trackPageview;
const trackError = analytics.trackError;
```

---

# analytics.js boilerplate

Best practices for implementing analytics.js on modern websites.

For an in-depth explanation of all the features used in this boilerplate (as well as how to report on them), see my article:

[**The Google Analytics Setup I Use on Every Site I Build**](https://philipwalton.com/articles/the-google-analytics-setup-i-use-on-every-site-i-build/) &#8594;

## Boilerplate versions

### [`analytics/base.js`](/src/analytics/base.js)

The base boilerplate extends the [default tracking snippet](https://developers.google.com/analytics/devguides/collection/analyticsjs/#alternative_async_tracking_snippet) and includes the following features:

- Tracks uncaught errors.
- Tracks custom user, session, and hit-level dimensions.
- Sends an initial pageview.
- Sends a pageload performance event.

### [`analytics/autotrack.js`](/src/analytics/autotrack.js)

The autotrack boilerplate builds on top the base boilerplate and includes [select autotrack plugins](https://philipwalton.com/articles/the-google-analytics-setup-i-use-on-every-site-i-build/#using-autotrack-plugins)

### [`analytics/multiple-trackers.js`](/src/analytics/multiple-trackers.js)

The multiple-trackers boilerplate builds on the autotrack boilerplate and includes support for using [multiple trackers](https://philipwalton.com/articles/the-google-analytics-setup-i-use-on-every-site-i-build/#testing-your-implementation).

## Running the boilerplate locally

analytics.js boilerplate uses [webpack](https://webpack.js.org/) to compile the source and [webpack-dev-server](https://github.com/webpack/webpack-dev-server) to run it locally.

To install the dependencies and load the boilerplate in a browser, run the following commands:

```sh
npm install
npm start
```

Then visit [localhost:8080](http://localhost:8080) in your browser and open the developer console to see the analytics.js debug output.

### Running different boilerplate versions

The boilerplate [`index.js`](/src/index.js#L7) JavaScript file imports the base boilerplate by default. To run a different version, replace the URL imported via `import('./analytics/base.js')` with the version you want to load.
